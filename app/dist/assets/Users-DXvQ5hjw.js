import{d as I,r as o,j as e,L as Z}from"./main-QCDkhjA5.js";import{P as ee,a as _,T as L}from"./trash-BxJeRo8U.js";import{A as z}from"./arrow-left-DnmTS9Bd.js";import{T as se}from"./triangle-alert-DRvvBewE.js";import{C as $}from"./chevron-down-CmoMxEBL.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],te=I("Shield",re);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ne=I("User",ae),B=({type:l,message:N,onDismiss:v})=>{const g=l==="error"?"bg-red-50":l==="success"?"bg-green-50":"bg-yellow-50",p=l==="error"?"text-red-600":l==="success"?"text-green-600":"text-yellow-600",j=l==="error"?"border-red-100":l==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${g} border ${j} rounded-md flex items-start justify-between`,children:[e.jsxs("div",{className:"flex items-start p-2",children:[l==="error"||l==="warning"?e.jsx(se,{className:`w-3 h-3 ${p} mr-2 mt-0.5`}):null,e.jsx("p",{className:`text-xs ${p}`,children:N})]}),v&&e.jsx("button",{onClick:v,className:`ml-2 mr-2 p-1 ${p} hover:bg-opacity-10 cursor-pointer rounded-full`,children:"×"})]})},me=()=>{const[l,N]=o.useState([]),[v,g]=o.useState(!0),[p,j]=o.useState(null),[w,d]=o.useState("list"),[a,x]=o.useState(null),[m,h]=o.useState({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]}),[A,D]=o.useState("overview"),[P,y]=o.useState(null),[R,E]=o.useState([]),[f,G]=o.useState("username"),[k,T]=o.useState("asc");console.log(p);const C=[{id:"ADMIN",label:"Administrator",description:"Full access to all of Argon & the admin panel"},{id:"USER",label:"User",description:"Standard user permissions"}];o.useEffect(()=>{b()},[]);const u=o.useCallback((t,s)=>{const r=Date.now().toString();return E(n=>[...n,{id:r,type:t,message:s}]),setTimeout(()=>{E(n=>n.filter(c=>c.id!==r))},5e3),r},[]),O=o.useCallback(t=>{E(s=>s.filter(r=>r.id!==t))},[]),b=async()=>{try{g(!0);const s={Authorization:`Bearer ${localStorage.getItem("token")}`},r=await fetch("/api/users",{headers:s});if(!r.ok){const i=await r.json();throw new Error(i.error||"Failed to fetch users")}const c=(await r.json()).map(i=>({...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}));N(c),j(null)}catch(t){const s=t instanceof Error?t.message:"An error occurred";j(s),u("error",s)}finally{g(!1)}},W=async t=>{try{g(!0);const s=localStorage.getItem("token"),r=await fetch(`/api/users/${t}`,{headers:{Authorization:`Bearer ${s}`}});if(!r.ok){const i=await r.json();throw new Error(i.error||"Failed to fetch user")}const n=await r.json(),c={...n,createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt)};return N(i=>i.map(S=>S.id===t?c:S)),a&&a.id===t&&x(c),j(null),c}catch(s){const r=s instanceof Error?s.message:"An error occurred";return u("error",r),null}finally{g(!1)}},q=async t=>{t.preventDefault(),y(null);try{const s=localStorage.getItem("token"),r=await fetch("/api/users",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(m)}),n=await r.json();if(!r.ok){const c=Array.isArray(n.error)?n.error.map(i=>i.message).join(", "):n.error||"Failed to create user";throw new Error(c)}await b(),d("list"),h({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]}),u("success",`User "${m.username}" created successfully`)}catch(s){const r=s instanceof Error?s.message:"Failed to create user";y(r),u("error",r)}},H=async t=>{if(t.preventDefault(),!!a){y(null);try{const s=localStorage.getItem("token"),r={...m};r.password||delete r.password;const n=await fetch(`/api/users/${a.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),c=await n.json();if(!n.ok){const S=Array.isArray(c.error)?c.error.map(Y=>Y.message).join(", "):c.error||"Failed to update user";throw new Error(S)}await b(),u("success",`User "${m.username}" updated successfully`);const i=await W(a.id);i&&x(i),d("view"),h({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]})}catch(s){const r=s instanceof Error?s.message:"Failed to update user";y(r),u("error",r)}}},M=async t=>{try{const s=localStorage.getItem("token"),r=await fetch(`/api/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to delete user")}await b(),(a==null?void 0:a.id)===t&&(d("list"),x(null)),u("success","User deleted successfully")}catch(s){const r=s instanceof Error?s.message:"Failed to delete user";u("error",r)}},U=t=>{f===t?T(s=>s==="asc"?"desc":"asc"):(G(t),T("asc"))},J=()=>[...l].sort((t,s)=>{let r=0;switch(f){case"username":r=t.username.localeCompare(s.username);break;case"permissions":r=t.permissions.length-s.permissions.length;break;case"createdAt":r=t.createdAt.getTime()-s.createdAt.getTime();break;default:r=0}return k==="asc"?r:-r}),K=t=>{h(s=>s.permissions.includes(t)?{...s,permissions:s.permissions.filter(r=>r!==t)}:{...s,permissions:[...s.permissions,t]})},F=t=>e.jsxs("form",{onSubmit:t==="create"?q:H,className:"space-y-4 max-w-lg",children:[P&&e.jsx(B,{type:"error",message:P,onDismiss:()=>y(null)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",value:m.username,onChange:s=>h({...m,username:s.target.value}),className:"block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"john.doe",required:!0,maxLength:100}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A unique username for this user"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:["Password ",t==="edit"&&e.jsx("span",{className:"text-gray-500",children:"(leave blank to keep current)"})]}),e.jsx("input",{type:"password",value:m.password,onChange:s=>h({...m,password:s.target.value}),className:"block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"••••••••",required:t==="create"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t==="create"?"Must be at least 8 characters long":"Enter a new password or leave blank to keep the current one"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Permissions"}),e.jsx("div",{className:"mt-2 space-y-2 border border-gray-200 rounded-md p-3",children:C.map(s=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("input",{type:"checkbox",id:`permission-${s.id}`,checked:m.permissions.includes(s.id),onChange:()=>K(s.id),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-xs font-medium text-gray-700 cursor-pointer",children:s.label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"submit",className:"px-3 py-2 text-xs font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800",children:t==="create"?"Create User":"Update User"}),e.jsx("button",{type:"button",onClick:()=>{d(t==="edit"?"view":"list"),t==="create"&&x(null),h({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]})},className:"px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:"Cancel"})]})]}),V=t=>e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(s=>{const r=C.find(n=>n.id===s);return e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700",title:r==null?void 0:r.description,children:(r==null?void 0:r.label)||s},s)})}),Q=()=>a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{d("list"),x(null)},className:"flex items-center text-gray-600 hover:bg-gray-100 p-2 cursor-pointer rounded-md transition hover:text-gray-900",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:a.username})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>{h({username:a.username,password:"",permissions:a.permissions}),d("edit")},className:"flex items-center px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:[e.jsx(_,{className:"w-3.5 h-3.5 mr-1.5"}),"Edit"]}),e.jsxs("button",{onClick:()=>M(a.id),className:"flex items-center px-3 py-2 text-xs font-medium text-red-600 bg-white border border-gray-200 rounded-md hover:bg-red-50",children:[e.jsx(L,{className:"w-3.5 h-3.5 mr-1.5"}),"Delete"]})]})]}),e.jsxs("div",{className:"flex space-x-4 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>D("overview"),className:`py-2 px-1 text-xs font-medium border-b-2 ${A==="overview"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Overview"}),e.jsx("button",{onClick:()=>D("permissions"),className:`py-2 px-1 text-xs font-medium border-b-2 ${A==="permissions"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Permissions"})]}),A==="overview"?e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"User ID"}),e.jsx("div",{className:"text-sm font-mono mt-1",children:a.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Username"}),e.jsx("div",{className:"text-sm mt-1",children:a.username})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Permissions"}),e.jsx("div",{className:"mt-1",children:V(a.permissions)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Created At"}),e.jsx("div",{className:"text-sm mt-1",children:a.createdAt.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Updated At"}),e.jsx("div",{className:"text-sm mt-1",children:a.updatedAt.toLocaleString()})]})]})})}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"User Permissions"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Permissions determine what actions the user can perform in the system."})]}),e.jsx("div",{className:"space-y-3",children:C.map(t=>e.jsx("div",{className:`p-3 rounded-md border ${a.permissions.includes(t.id)?"bg-gray-50 border-gray-200":"bg-white border-gray-100"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`mt-0.5 mr-3 ${a.permissions.includes(t.id)?"text-gray-700":"text-gray-300"}`,children:e.jsx(te,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description}),e.jsx("div",{className:"text-xs mt-1",children:a.permissions.includes(t.id)?e.jsx("span",{className:"text-green-600",children:"Granted"}):e.jsx("span",{className:"text-gray-400",children:"Not granted"})})]})]})},t.id))})]})})})]}):null,X=()=>{const t=J();return e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-transparent",children:[e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>U("username"),children:e.jsxs("div",{className:"flex items-center",children:["Username",f==="username"&&e.jsx($,{className:`w-4 h-4 ml-1 ${k==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>U("permissions"),children:e.jsxs("div",{className:"flex items-center",children:["Permissions",f==="permissions"&&e.jsx($,{className:`w-4 h-4 ml-1 ${k==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>U("createdAt"),children:e.jsxs("div",{className:"flex items-center",children:["Created",f==="createdAt"&&e.jsx($,{className:`w-4 h-4 ml-1 ${k==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-right text-xs font-medium text-gray-600 tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{x(s),d("view")},children:[e.jsx("td",{className:"p-3 text-xs text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"font-medium",children:s.username})]})}),e.jsx("td",{className:"p-3 text-xs",children:V(s.permissions)}),e.jsx("td",{className:"p-3 text-xs text-gray-500",children:s.createdAt.toLocaleDateString()}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),h({username:s.username,password:"",permissions:s.permissions}),x(s),d("edit")},className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),M(s.id)},className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},s.id)),l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-500 text-xs",children:"No users found"})})]})]})})};return v&&l.length===0?e.jsx(Z,{}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"p-6",children:[R.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:R.map(t=>e.jsx(B,{type:t.type,message:t.message,onDismiss:()=>O(t.id)},t.id))}),e.jsxs("div",{className:"transition-all duration-200 ease-in-out",children:[w==="list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Users"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Manage users and their permissions for accessing the panel."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:b,className:"flex items-center px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:"Refresh"}),e.jsxs("button",{onClick:()=>d("create"),className:"flex items-center px-3 py-2 text-xs font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800",children:[e.jsx(ee,{className:"w-3.5 h-3.5 mr-1.5"}),"Create User"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:X()})]}),w==="create"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{d("list"),x(null)},className:"flex items-center text-gray-600 hover:bg-gray-100 p-2 cursor-pointer rounded-md transition hover:text-gray-900",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Create User"})})]}),F("create")]}),w==="edit"&&F("edit"),w==="view"&&Q()]})]})})};export{me as default};
