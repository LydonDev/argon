import{r,u as A,j as e,L as D,a as P,T as B,C as O,X as $}from"./main-B1FWiW_Q.js";import{C as z}from"./chevron-right-BGfmBojJ.js";import{F as Y}from"./folder-Dm7ZuZsp.js";function G({title:s,titleId:l,...i},m){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":l},i),s?r.createElement("title",{id:l},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const M=r.forwardRef(G),H=({isOpen:s,onClose:l,title:i,children:m,maxWidth:n="max-w-md"})=>{const o=r.useRef(null);return r.useEffect(()=>{const u=x=>{o.current&&x.target instanceof Node&&!o.current.contains(x.target)&&l()},g=x=>{x.key==="Escape"&&l()};return s&&(document.addEventListener("mousedown",u),document.addEventListener("keydown",g),document.body.style.overflow="hidden"),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("keydown",g),document.body.style.overflow="auto"}},[s,l]),s?e.jsx("div",{className:"fixed inset-0 bg-gray-100 bg-opacity-50 z-50 flex items-center justify-center p-4 transition-opacity duration-200 ease-in-out animate-fade-in",children:e.jsxs("div",{ref:o,className:`bg-white rounded-lg shadow-xs w-full ${n} transform transition-all duration-200 ease-in-out animate-scale-in`,children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:i}),e.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 transition-colors duration-150",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:m})]})}):null},L=({type:s,message:l,onDismiss:i})=>{const m=s==="error"?"bg-red-50":s==="success"?"bg-green-50":"bg-yellow-50",n=s==="error"?"text-red-600":s==="success"?"text-green-600":"text-yellow-600",o=s==="error"?"border-red-100":s==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${m} border ${o} rounded-md flex items-start justify-between mb-4`,children:[e.jsxs("div",{className:"flex items-start p-3",children:[s==="error"||s==="warning"?e.jsx(B,{className:`w-4 h-4 ${n} mr-2 mt-0.5`}):e.jsx(O,{className:`w-4 h-4 ${n} mr-2 mt-0.5`}),e.jsx("p",{className:`text-xs ${n}`,children:l})]}),i&&e.jsx("button",{onClick:i,className:`p-2 ${n} hover:bg-opacity-10 cursor-pointer rounded-full`,children:e.jsx($,{className:"w-4 h-4"})})]})},U=({isOpen:s,onClose:l,server:i,onMove:m,projects:n,currentProjectId:o,isSubmitting:u,error:g})=>{const[x,f]=r.useState("");return r.useEffect(()=>{if(s&&n.length>0){const c=n.find(h=>h.id!==o);c?f(c.id):n.length>0&&f(n[0].id)}},[s,n,o]),!s||!i?null:e.jsxs(H,{isOpen:s,onClose:l,title:"Move Server to Project",children:[g&&e.jsx(L,{type:"error",message:g}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Move ",e.jsx("span",{className:"font-medium",children:i.name})," to another project"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Select Project"}),e.jsx("select",{value:x,onChange:c=>f(c.target.value),className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-gray-400",children:n.map(c=>e.jsxs("option",{value:c.id,disabled:c.id===i.projectId,children:[c.name," ",c.id===i.projectId?"(Current)":""]},c.id))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50 transition-colors duration-150",disabled:u,children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>m(x),disabled:u||x===i.projectId,className:"px-4 py-2 text-xs font-medium text-white bg-gray-900 border border-transparent rounded-md hover:bg-gray-800 focus:outline-none transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Moving...":"Move Server"})]})]})};function J(){const{currentProject:s,projects:l,moveServerToProject:i}=A(),[m,n]=r.useState([]),[o,u]=r.useState([]),[g,x]=r.useState(!0),[f,c]=r.useState(null),[h,S]=r.useState("servers"),[F,y]=r.useState(!1),[v,N]=r.useState(null),[T,k]=r.useState(!1),[I,b]=r.useState(null),[E,p]=r.useState(null);r.useEffect(()=>{w()},[]),r.useEffect(()=>{if(s&&m.length>0){const t=m.filter(a=>a.projectId===s.id);u(t)}else u(m)},[s,m]);const j={total:o.length,online:o.filter(t=>{var a,d;return((d=(a=t.status)==null?void 0:a.status)==null?void 0:d.state)==="running"}).length,offline:o.filter(t=>{var a,d;return((d=(a=t.status)==null?void 0:a.status)==null?void 0:d.state)!=="running"}).length},R=async t=>{if(v)try{b(null),k(!0),await i(v.id,t),n(a=>a.map(d=>d.id===v.id?{...d,projectId:t}:d)),y(!1),N(null),p("Server moved to project successfully"),setTimeout(()=>{p(null)},3e3)}catch(a){console.error("Failed to move server:",a),b(a instanceof Error?a.message:"Failed to move server")}finally{k(!1)}},w=async()=>{try{x(!0);const t=localStorage.getItem("token"),a=await fetch("/api/servers",{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to fetch servers");const d=await a.json();n(d),c(null)}catch(t){c(t instanceof Error?t.message:"An error occurred")}finally{x(!1)}};return g?e.jsx(D,{}):f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-red-600 text-sm",children:["Failed to load servers: ",f]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"w-full mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Servers"}),s&&e.jsx("p",{className:"text-sm text-gray-500",children:s.isDefault?"Showing all servers in the Default project":`Showing servers in ${s.name} project`})]}),e.jsxs("button",{onClick:w,className:"flex items-center px-4 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50 transition-colors duration-150",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),E&&e.jsx(L,{type:"success",message:E,onDismiss:()=>p(null)}),e.jsx("div",{className:"border-b border-gray-200 mb-8",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>S("servers"),className:`pb-2 text-md font-medium relative ${h==="servers"?"text-gray-800 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:["All servers ",e.jsx("span",{className:"text-gray-500 ml-0.5 mr-0.5",children:j.total}),h==="servers"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>S("overview"),className:`pb-2 ml-6 text-md font-medium relative ${h==="overview"?"text-gray-800 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:["Overview",h==="overview"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600"})]})]})}),h==="servers"&&e.jsx("div",{children:o.length>0?e.jsx("div",{className:"space-y-1.5",children:o.map(t=>{var a,d,C;return e.jsx("div",{className:"block bg-white rounded-md border border-gray-200 shadow-xs overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{to:`/servers/${t.id}/console`,className:"px-3 py-3 flex-grow flex items-center justify-between hover:bg-gray-50 transition-colors duration-150",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`h-1.5 w-1.5 rounded-full ${((d=(a=t.status)==null?void 0:a.status)==null?void 0:d.state)==="running"?"bg-green-400":"bg-gray-300"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 truncate",children:t.name}),e.jsx("div",{className:"text-[11px] text-gray-500",children:(C=t.status)==null?void 0:C.id})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("div",{className:"text-[11px] text-gray-500",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[t.cpuPercent,"%"]})," CPU limit"]}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[(t.memoryMiB/1024).toFixed(2)," GiB"]})," Memory limit"]})]}),e.jsx(z,{className:"h-3.5 w-3.5 text-gray-400"})]})]}),l.length>1&&e.jsx("button",{onClick:()=>{N(t),b(null),y(!0)},className:"h-full px-3 border-l border-gray-200 text-gray-400 cursor-pointer hover:text-gray-600 transition-colors duration-150",title:"Move to different project",children:e.jsx(Y,{className:"w-4 h-4"})})]})},t.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"w-32 h-32 mb-6",children:e.jsx("img",{src:"https://static.nebius.com/common/illustrations/compute/empty/light.svg",alt:"No servers",className:"w-full h-full"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:s!=null&&s.isDefault?"No servers found":`No servers in ${s==null?void 0:s.name}`}),e.jsx("p",{className:"text-gray-500 text-center max-w-md mb-6",children:s!=null&&s.isDefault?"You don't have any active servers yet. To create a new server, please contact your administrator.":"There are no servers in this project yet. You can move servers here from other projects."}),e.jsxs("button",{onClick:w,className:"flex items-center justify-center border border-gray-300 rounded-md px-4 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 transition-colors duration-150",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Refresh server list"]})]})}),h==="overview"&&e.jsxs("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:s?`${s.name} Project Overview`:"Server Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-md p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"Total Servers"}),e.jsx("div",{className:"text-2xl font-medium",children:j.total})]}),e.jsxs("div",{className:"border border-gray-200 rounded-md p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"Online"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-400 mr-2"}),e.jsx("div",{className:"text-2xl font-medium",children:j.online})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-md p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"Offline"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-gray-300 mr-2"}),e.jsx("div",{className:"text-2xl font-medium",children:j.offline})]})]})]}),s&&s.description&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-md border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Project Description"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]})]}),e.jsx(U,{isOpen:F,onClose:()=>{y(!1),N(null),b(null)},server:v,onMove:R,projects:l,currentProjectId:(s==null?void 0:s.id)||null,isSubmitting:T,error:I})]})}export{J as default};
