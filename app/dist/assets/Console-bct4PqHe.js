import{d as w,j as e,f as z,g as H,r as x,L as D}from"./main-mgENhJxE.js";import{C as K}from"./chevron-right-L0shKbuN.js";import{C as Y,R as Z}from"./refresh-cw-7ofqJox1.js";import{G as Q}from"./globe-DLw-WynS.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],X=w("Hash",V);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],te=w("Play",ee);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ne=w("Send",se);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],re=w("Square",ae);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],ce=w("Terminal",oe),F={light:{0:"#000000",1:"#d16969",2:"#b5cea8",3:"#d7ba7d",4:"#569cd6",5:"#c586c0",6:"#9cdcfe",7:"#d4d4d4",8:"#808080",9:"#d16969",10:"#b5cea8",11:"#d7ba7d",12:"#569cd6",13:"#c586c0",14:"#9cdcfe",15:"#ffffff"},dark:{0:"#666666",1:"#ff6b6b",2:"#c2e085",3:"#ffd700",4:"#7cb7ff",5:"#ff8ae2",6:"#79eeff",7:"#ffffff",8:"#999999",9:"#ff8080",10:"#d4ff80",11:"#ffed80",12:"#80caff",13:"#ff99ff",14:"#80ffff",15:"#ffffff"}},ie=({text:y})=>{const t=(s=>{const i=[];let r={text:"",style:{}},l=0;for(;l<s.length;)if(s[l]==="\x1B"&&s[l+1]==="["){r.text&&(i.push({...r}),r={text:"",style:{...r.style}}),l+=2;let h="";for(;l<s.length&&s[l]!=="m";)h+=s[l],l++;l++;const p=h.split(";").map(Number);for(let m=0;m<p.length;m++){const n=p[m];n===0?r.style={}:n===1?r.style.fontWeight="bold":n===3?r.style.fontStyle="italic":n===4?r.style.textDecoration="underline":n>=30&&n<=37?r.style.color=`var(--ansi-${n-30})`:n>=90&&n<=97?r.style.color=`var(--ansi-${n-82})`:n>=40&&n<=47?r.style.backgroundColor=`var(--ansi-bg-${n-40})`:n>=100&&n<=107&&(r.style.backgroundColor=`var(--ansi-bg-${n-92})`)}}else r.text+=s[l],l++;return r.text&&i.push(r),i})(y);return e.jsxs("div",{className:"font-mono leading-5 whitespace-pre-wrap text-gray-100 dark:text-gray-200",children:[e.jsx("style",{children:`
                    :root {
                        /* Light mode ANSI colors */
                        ${Object.entries(F.light).map(([s,i])=>`
                            .light-theme {
                                --ansi-${s}: ${i};
                                --ansi-bg-${s}: ${i}20;
                            }
                        `).join(`
`)}

                        /* Dark mode ANSI colors */
                        ${Object.entries(F.dark).map(([s,i])=>`
                            .dark-theme {
                                --ansi-${s}: ${i};
                                --ansi-bg-${s}: ${i}20;
                            }
                        `).join(`
`)}
                    }
                `}),t.map((s,i)=>e.jsx("span",{style:{...s.style,fontFamily:"JetBrains Mono"},children:s.text},i))]})},v=(y,j=2)=>{if(!y||y===0)return"0 Bytes";const t=1024,s=j<0?0:j,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(y)/Math.log(t));return parseFloat((y/Math.pow(t,r)).toFixed(s))+" "+i[r]},fe=()=>{var M,W,O,P,I;const{id:y}=z(),j=H(),[t,s]=x.useState(null),[i,r]=x.useState(!0),[l,h]=x.useState(null),[p,m]=x.useState([]),[n,L]=x.useState(""),[q,A]=x.useState(!1),[k,S]=x.useState(!1),[B,T]=x.useState({cpuPercent:0,memory:{used:0,limit:0,percent:0},network:{rxBytes:0,txBytes:0}}),d=x.useRef(null),C=x.useRef(null);x.useEffect(()=>((async()=>{var c,b;try{const g=localStorage.getItem("token"),N=await fetch(`/api/servers/${y}?include[node]=true&include[status]=true`,{headers:{Authorization:`Bearer ${g}`}});if(!N.ok)throw new Error("Failed to fetch server");const a=await N.json();if(!((c=a.node)!=null&&c.fqdn)||!((b=a.node)!=null&&b.port))throw new Error("Server node information is missing");s(a),E(a)}catch(g){h(g instanceof Error?g.message:"An error occurred")}finally{r(!1)}})(),()=>{d.current&&d.current.close()}),[y]),x.useEffect(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[p]);const E=o=>{if(!localStorage.getItem("token")){h("Authentication token not found");return}d.current&&d.current.close();const b=`ws://${o.node.fqdn}:${o.node.port}?server=${o.internalId}&token=${o.validationToken}`,g=new WebSocket(b);d.current=g,g.onopen=()=>{console.log("WebSocket connected"),A(!0),h(null)},g.onmessage=N=>{const a=JSON.parse(N.data);switch(a.event){case"console_output":typeof a.data.message=="string"&&m(f=>[...f,a.data.message]);break;case"auth_success":a.data.logs&&m(a.data.logs.map(f=>f));break;case"stats":a.data.cpu_percent!==void 0&&T({cpuPercent:a.data.cpu_percent||0,memory:a.data.memory||{used:0,limit:0,percent:0},network:a.data.network?{rxBytes:a.data.network.rx_bytes,txBytes:a.data.network.tx_bytes}:{rxBytes:0,txBytes:0}}),a.data.state&&s(f=>f?{...f,state:a.data.state||f.state}:null);break;case"power_status":a.data.status!==void 0&&m(f=>[...f,a.data.status.toString()]),S(!1);break;case"error":const R=a.data.message||"An unknown error occurred";h(R),m(f=>[...f,`Error: ${R}`]),S(!1);break}},g.onclose=()=>{console.log("WebSocket disconnected"),A(!1),setTimeout(()=>{(!d.current||d.current.readyState===WebSocket.CLOSED)&&E(o)},5e3)},g.onerror=N=>{console.error("WebSocket error:",N),h("We're having trouble connecting to your server...")}},J=o=>{if(o.preventDefault(),!n.trim()||!d.current){m(c=>[...c,"\x1B[33m[System] Cannot send command - WebSocket not connected or empty command\x1B[0m"]);return}if(!u){m(c=>[...c,"\x1B[33m[System] Cannot send command - server is not running\x1B[0m"]);return}try{d.current.send(JSON.stringify({event:"send_command",data:n})),m(c=>[...c,"\x1B[32m$ \x1B[0m"+n+"\x1B[0m"]),L("")}catch(c){m(b=>[...b,`\x1B[31m[System] Failed to send command: ${c}\x1B[0m`])}},G=()=>{if(!d.current)return"No WebSocket connection";switch(d.current.readyState){case WebSocket.CONNECTING:return"Connecting...";case WebSocket.OPEN:return"Connected";case WebSocket.CLOSING:return"Closing...";case WebSocket.CLOSED:return"Closed";default:return"Unknown"}},$=async o=>{if(!(!t||k||!d.current)){S(!0);try{d.current.send(JSON.stringify({event:"power_action",data:{action:o}}))}catch(c){h(c instanceof Error?c.message:`Failed to ${o} server`),S(!1)}}},U=o=>{switch(o==null?void 0:o.toLowerCase()){case"running":return"text-green-500";case"stopped":return"text-red-500";case"installing":return"text-yellow-500";default:return"text-gray-500"}};if(i)return e.jsx(D,{});const u=((M=t==null?void 0:t.state)==null?void 0:M.toLowerCase())==="running";let _=(W=t==null?void 0:t.status)!=null&&W.allocation?JSON.parse(t.status.allocation):null;return e.jsx("div",{className:"min-h-screen px-8 py-8 bg-gray-50",children:e.jsxs("div",{className:"max-w-[1500px] mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>j("/servers"),className:"hover:text-gray-900",children:"Servers"}),e.jsx(K,{className:"w-4 h-4 mx-1"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t==null?void 0:t.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t==null?void 0:t.name}),e.jsxs("div",{className:"flex items-center space-x-3",children:[l&&e.jsxs("div",{className:`flex items-center px-3 py-1.5 text-xs text-red-700 bg-red-50 
                              border border-red-100 rounded-md`,children:[e.jsx(Y,{className:"w-3.5 h-3.5 mr-1.5"}),l]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>$("start"),disabled:k||u,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(te,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>$("restart"),disabled:k||!u,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(Z,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>$("stop"),disabled:k||!u,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(re,{className:"w-4 h-4 text-gray-700"})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(X,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{children:t==null?void 0:t.internalId.split("-",1)})]}),e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(Q,{className:"w-4 h-4 mr-1.5"}),e.jsxs("span",{children:[t!=null&&t.allocation.alias?t==null?void 0:t.allocation.alias:t==null?void 0:t.allocation.bindAddress,":",(_==null?void 0:_.port)||"unknown"]})]}),e.jsxs("div",{className:`flex items-center ${U((t==null?void 0:t.state)||"")}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${((O=t==null?void 0:t.state)==null?void 0:O.toLowerCase())==="running"?"bg-green-500":((P=t==null?void 0:t.state)==null?void 0:P.toLowerCase())==="stopped"?"bg-red-500":((I=t==null?void 0:t.state)==null?void 0:I.toLowerCase())==="installed"?"bg-gray-500":"bg-yellow-500"}`}),e.jsx("span",{children:((t==null?void 0:t.state.charAt(0).toUpperCase())+(t==null?void 0:t.state.slice(1))).replace("Installed","Connecting...")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6 border-t border-b border-gray-200/50 py-8",children:[e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"CPU Usage"}),e.jsx("div",{className:"flex items-baseline mt-1",children:e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:u?`${B.cpuPercent.toFixed(1)}%`:"-"})})]}),e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Memory"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:u?v(B.memory.used):"-"}),u&&e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-500",children:["/ ",v(t==null?void 0:t.status.memory_limit)]})]})]}),e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Network I/O"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:u?v(B.network.rxBytes):"-"}),u&&e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:"/s in"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Disk Space"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:v(((t==null?void 0:t.diskMiB)||0)*1024*1024)}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:"total"})]})]})]}),e.jsxs("div",{className:`border-2 border-gray-50 rounded-2xl ring-2 ring-gray-50
                      ring-offset-1 ring-offset-gray-300 bg-[#191b25]`,children:[e.jsx("div",{ref:C,style:{fontFamily:"JetBrains Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},className:"h-[400px] p-4 overflow-y-auto text-xs text-gray-300 relative",children:p.length>0?p.map((o,c)=>e.jsx(ie,{text:o},c)):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-500 mt-4",children:[e.jsx(ce,{className:`w-12 h-12 mb-2 ring-2 ring-[#191b25] border-4 border-[#191b25] ring-offset-1 
                                 ring-offset-white/5 opacity-80 bg-white/5 rounded-xl p-3`}),e.jsx("p",{className:"text-sm mt-4 text-gray-400/90 font-medium",children:"No console output available"}),e.jsx("p",{className:"text-xs mt-1",children:"Perform an action to see some logs here!"})]})}),e.jsx("div",{className:"bg-[#30313a] p-2 m-2 rounded-b-xl rounded-t-md",children:e.jsxs("form",{onSubmit:J,className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:n,onChange:o=>L(o.target.value),placeholder:"$ server~",className:`flex-1 bg-[#30313a] text-gray-100 rounded-md text-sm transition px-3 py-2 
                         focus:outline-none focus:ring-1 focus:ring-transparent placeholder:text-gray-500`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs hidden text-gray-500",children:G()}),e.jsxs("button",{type:"submit",disabled:!q||!u,className:`flex items-center px-3 py-2 cursor-pointer border border-white/5 text-xs font-medium 
                           text-indigo-100 bg-indigo-800/30 rounded-md hover:bg-indigo-800/50 disabled:opacity-50 
                           disabled:cursor-not-allowed transition-colors duration-200`,children:[e.jsx(ne,{className:"w-3.5 h-3.5 mr-1.5"}),"Send"]})]})]})})]})]})})};export{fe as default};
