import{g as P,h as J,r as i,j as e,L as O,C as U}from"./main-DFB4SX2f.js";import{C as S}from"./circle-alert-D_weM-AU.js";import{C}from"./chevron-right-D83jph9Y.js";import{R as v}from"./refresh-cw-Dv33gjfd.js";import{S as b}from"./save-D_fa2_hK.js";import{X as H}from"./x-CBQJztKQ.js";const L=({toast:n,onDismiss:u})=>e.jsxs("div",{className:`fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2 z-50
      ${n.type==="success"?"bg-gray-900 text-white":"bg-red-500 text-white"}`,children:[n.type==="success"?e.jsx(U,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:n.message}),e.jsx("button",{onClick:()=>u(n.id),className:"ml-2 text-white/80 hover:text-white",children:e.jsx(H,{className:"w-4 h-4"})})]}),V=()=>{const{id:n}=P(),u=J(),h=localStorage.getItem("token"),[g,N]=i.useState(null),[r,p]=i.useState(null),[I,w]=i.useState(!0),[d,l]=i.useState({}),[k,F]=i.useState(null),[E,f]=i.useState([]),[c,m]=i.useState({name:"",dockerImage:"",startupCommand:""}),o=(a,s="success")=>{const t=Math.random().toString(36);f(j=>[...j,{id:t,message:a,type:s}]),setTimeout(()=>{f(j=>j.filter(B=>B.id!==t))},4e3)},D=a=>{f(s=>s.filter(t=>t.id!==a))},A=async()=>{try{w(!0);const a=await fetch(`/api/servers/${n}?include[node]=true`,{headers:{Authorization:`Bearer ${h}`}});if(!a.ok)throw new Error("Failed to fetch server details");const s=await a.json();N(s)}catch{F("Failed to fetch server details"),o("Failed to fetch server details","error")}finally{w(!1)}},$=async()=>{try{const a=await fetch(`/api/servers/${n}/configuration`,{headers:{Authorization:`Bearer ${h}`}});if(!a.ok)throw new Error("Failed to fetch server configuration");const s=await a.json();if(typeof s.dockerImage.available=="string")try{s.dockerImage.available=JSON.parse(s.dockerImage.available)}catch(t){console.error("Failed to parse available Docker images:",t),s.dockerImage.available=[]}p(s),m({name:s.name,dockerImage:s.dockerImage.current,startupCommand:s.startupCommand.current})}catch{o("Failed to fetch server configuration","error")}},T=async()=>{if(!c.name.trim()){o("Server name cannot be empty","error");return}try{l(t=>({...t,name:!0}));const a=await fetch(`/api/servers/${n}/name`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({name:c.name})});if(!a.ok){const t=await a.json();throw new Error(t.error||"Failed to update server name")}const s=await a.json();o("Server name updated successfully"),N(t=>t?{...t,name:s.name}:null),p(t=>t?{...t,name:s.name}:null)}catch(a){o(a instanceof Error?a.message:"Failed to update server name","error")}finally{l(a=>({...a,name:!1}))}},z=async()=>{try{l(t=>({...t,dockerImage:!0}));const a=await fetch(`/api/servers/${n}/docker-image`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({dockerImage:c.dockerImage})});if(!a.ok){const t=await a.json();throw new Error(t.error||"Failed to update Docker image")}const s=await a.json();o("Docker image updated successfully"),p(t=>t?{...t,dockerImage:{...t.dockerImage,current:s.dockerImage}}:null)}catch(a){o(a instanceof Error?a.message:"Failed to update Docker image","error")}finally{l(a=>({...a,dockerImage:!1}))}},R=async()=>{if(!c.startupCommand.trim()){o("Startup command cannot be empty","error");return}try{l(t=>({...t,startupCommand:!0}));const a=await fetch(`/api/servers/${n}/startup-command`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({startupCommand:c.startupCommand})});if(!a.ok){const t=await a.json();throw new Error(t.error||"Failed to update startup command")}const s=await a.json();o("Startup command updated successfully"),p(t=>t?{...t,startupCommand:{...t.startupCommand,current:s.startupCommand}}:null)}catch(a){o(a instanceof Error?a.message:"Failed to update startup command","error")}finally{l(a=>({...a,startupCommand:!1}))}},y=a=>{if(r)switch(a){case"name":m(s=>({...s,name:r.name}));break;case"dockerImage":m(s=>({...s,dockerImage:r.dockerImage.current}));break;case"startupCommand":m(s=>({...s,startupCommand:r.startupCommand.current}));break}},x=a=>{if(!r)return!1;switch(a){case"name":return c.name!==r.name;case"dockerImage":return c.dockerImage!==r.dockerImage.current;case"startupCommand":return c.startupCommand!==r.startupCommand.current;default:return!1}};return i.useEffect(()=>{A()},[n]),i.useEffect(()=>{g&&$()},[g]),I?e.jsx(O,{}):k?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:k}),e.jsx("button",{onClick:()=>u("/servers"),className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800",children:"Back to Servers"})]})}):e.jsxs("div",{className:"min-h-screen px-8 py-8 bg-gray-50",children:[E.map(a=>e.jsx(L,{toast:a,onDismiss:D},a.id)),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>u("/servers"),className:"hover:text-gray-900 transition-colors duration-100",children:"Servers"}),e.jsx(C,{className:"w-4 h-4 mx-1"}),e.jsx("button",{onClick:()=>u(`/servers/${n}`),className:"hover:text-gray-900 transition-colors duration-100",children:g==null?void 0:g.name}),e.jsx(C,{className:"w-4 h-4 mx-1"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Settings"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Settings"})})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Server Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Change the display name of your server"})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Server Name"}),e.jsx("input",{type:"text",value:c.name,onChange:a=>m(s=>({...s,name:a.target.value})),className:`w-full px-3 py-2 border border-gray-200 rounded-md text-sm 
                           focus:outline-none focus:ring-2 focus:ring-gray-200`,placeholder:"Enter server name"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Changes will be reflected across the panel"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[x("name")&&e.jsx("button",{onClick:()=>y("name"),className:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900",children:"Reset"}),e.jsx("button",{onClick:T,disabled:d.name||!x("name"),className:`px-4 py-1.5 text-xs font-medium text-white bg-gray-900 rounded-md 
                             hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed
                             flex items-center space-x-1`,children:d.name?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:"Save"})]})})]})]})]})]}),(r==null?void 0:r.dockerImage.canChange)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Docker Image"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select the Docker image for your server"})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Images"}),e.jsx("select",{value:c.dockerImage,onChange:a=>m(s=>({...s,dockerImage:a.target.value})),className:`w-full px-3 py-2 border border-gray-200 rounded-md text-sm 
                             focus:outline-none focus:ring-2 focus:ring-gray-200`,children:Array.isArray(r.dockerImage.available)&&r.dockerImage.available.map(a=>e.jsx("option",{value:a.image,children:a.displayName||a.image},a.image))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Server will be restarted to apply changes"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[x("dockerImage")&&e.jsx("button",{onClick:()=>y("dockerImage"),className:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900",children:"Reset"}),e.jsx("button",{onClick:z,disabled:d.dockerImage||!x("dockerImage"),className:`px-4 py-1.5 text-xs font-medium text-white bg-gray-900 rounded-md 
                               hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed
                               flex items-center space-x-1`,children:d.dockerImage?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:"Update"})]})})]})]})]})]}),(r==null?void 0:r.startupCommand.canEdit)&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Startup Command"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Customize the command used to start your server"})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Command"}),e.jsx("textarea",{value:c.startupCommand,onChange:a=>m(s=>({...s,startupCommand:a.target.value})),rows:3,className:`w-full px-3 py-2 border border-gray-200 rounded-md text-sm font-mono
                             focus:outline-none focus:ring-2 focus:ring-gray-200`,placeholder:"Enter startup command"}),r.startupCommand.default&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Default: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:r.startupCommand.default})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Server will be restarted to apply changes"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[x("startupCommand")&&e.jsx("button",{onClick:()=>y("startupCommand"),className:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900",children:"Reset"}),e.jsx("button",{onClick:R,disabled:d.startupCommand||!x("startupCommand"),className:`px-4 py-1.5 text-xs font-medium text-white bg-gray-900 rounded-md 
                               hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed
                               flex items-center space-x-1`,children:d.startupCommand?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:"Update"})]})})]})]})]})]})]})]})]})};export{V as default};
