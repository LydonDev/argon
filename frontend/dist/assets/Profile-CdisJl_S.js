import{b as A,r as n,j as e,E as y,d as j,C as F}from"./main-D3qaoigP.js";import{T}from"./triangle-alert-GFLydapA.js";import{X as D}from"./x-B6kzdy8S.js";const U=({type:r,message:w,onDismiss:s})=>{const c=r==="error"?"bg-red-50":r==="success"?"bg-green-50":"bg-yellow-50",a=r==="error"?"text-red-600":r==="success"?"text-green-600":"text-yellow-600",g=r==="error"?"border-red-100":r==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${c} border ${g} rounded-md flex items-start justify-between mb-4`,children:[e.jsxs("div",{className:"flex items-start p-3",children:[r==="error"||r==="warning"?e.jsx(T,{className:`w-4 h-4 ${a} mr-2 mt-0.5`}):e.jsx(F,{className:`w-4 h-4 ${a} mr-2 mt-0.5`}),e.jsx("p",{className:`text-sm ${a}`,children:w})]}),s&&e.jsx("button",{onClick:s,className:`p-2 ${a} hover:bg-opacity-10 cursor-pointer rounded-full`,children:e.jsx(D,{className:"w-4 h-4"})})]})},O=()=>{const{user:r,logout:w}=A(),[s,c]=n.useState({newUsername:"",currentPassword:"",newPassword:"",confirmPassword:""}),[a,g]=n.useState(!1),[h,k]=n.useState(!1),[b,E]=n.useState(!1),[m,N]=n.useState(!1),[P,o]=n.useState(null),[v,p]=n.useState(null),[i,C]=n.useState("profile"),u=l=>{const{name:t,value:d}=l.target;c(x=>({...x,[t]:d}))},$=()=>{const l=!!s.newUsername,t=!!(s.currentPassword&&s.newPassword);if(!l&&!t)return o("Please fill in at least one field to update your profile"),!1;if(l&&r&&s.newUsername===r.username)return o("New username must be different from current username"),!1;if(t){if(!s.currentPassword)return o("Current password is required to update password"),!1;if(s.newPassword.length<8)return o("New password must be at least 8 characters"),!1;if(s.newPassword!==s.confirmPassword)return o("New password and confirmation do not match"),!1}return!0},S=async l=>{if(l.preventDefault(),o(null),p(null),!!$()){N(!0);try{const t=localStorage.getItem("token"),d={};s.newUsername&&(d.newUsername=s.newUsername),s.currentPassword&&s.newPassword&&(d.currentPassword=s.currentPassword,d.newPassword=s.newPassword);const x=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(d)}),f=await x.json();if(!x.ok)throw new Error(f.error||"Failed to update profile");f.token&&(localStorage.setItem("token",f.token),setTimeout(()=>{window.location.reload()},1500)),c({newUsername:"",currentPassword:"",newPassword:"",confirmPassword:""}),p(f.message||"Profile updated successfully")}catch(t){o(t instanceof Error?t.message:"An error occurred while updating your profile")}finally{N(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Account Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your account information and security settings"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>C("profile"),className:`pb-3 text-sm font-medium relative ${i==="profile"?"text-gray-800 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:["Profile",i==="profile"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>C("security"),className:`pb-3 ml-6 text-sm font-medium relative ${i==="security"?"text-gray-800 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:["Security",i==="security"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-xs",children:e.jsxs("div",{className:"p-6",children:[P&&e.jsx(U,{type:"error",message:P,onDismiss:()=>o(null)}),v&&e.jsx(U,{type:"success",message:v,onDismiss:()=>p(null)}),i==="profile"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-1",children:"Profile Information"}),e.jsxs("div",{className:"text-gray-400 text-xs font-normal uppercase tracking-widest mb-4 mt-2",children:["Current Username: ",r==null?void 0:r.username]}),e.jsx("div",{className:"mb-6",children:e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"newUsername",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Username"}),e.jsx("input",{id:"newUsername",type:"text",name:"newUsername",value:s.newUsername,onChange:u,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Enter new username"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave blank if you don't want to change your username"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:m||!s.newUsername&&!s.currentPassword,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Updating...":"Update Profile"})})]})})]}),i==="security"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Password"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"currentPassword",type:a?"text":"password",name:"currentPassword",value:s.currentPassword,onChange:u,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Enter current password"}),e.jsx("button",{type:"button",onClick:()=>g(!a),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:a?e.jsx(y,{className:"w-4 h-4"}):e.jsx(j,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"newPassword",type:h?"text":"password",name:"newPassword",value:s.newPassword,onChange:u,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Enter new password"}),e.jsx("button",{type:"button",onClick:()=>k(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:h?e.jsx(y,{className:"w-4 h-4"}):e.jsx(j,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"confirmPassword",type:b?"text":"password",name:"confirmPassword",onChange:u,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Confirm new password"}),e.jsx("button",{type:"button",onClick:()=>E(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:b?e.jsx(y,{className:"w-4 h-4"}):e.jsx(j,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:m||!s.currentPassword||!s.newPassword||!s.confirmPassword,className:"transition px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Updating...":"Update Password"})})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Danger Zone"}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:w,className:"transition px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Log out all sessions"})})]})]})]})})]})})};export{O as default};
