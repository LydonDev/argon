import{c as C,j as e,f as ne,g as re,r as d,L as ae}from"./main-BVRzkQeP.js";import{C as oe}from"./chevron-right-DnXFIXNP.js";import{C as Y,R as ce}from"./refresh-cw-UTl5cutH.js";import{G as ie}from"./globe-CVjjV-w1.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],de=C("Hash",le);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],xe=C("Play",me);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ue=C("Send",fe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],ye=C("Square",ge);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],pe=C("Terminal",he);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ne=C("WifiOff",be),Z={light:{0:"#000000",1:"#d16969",2:"#b5cea8",3:"#d7ba7d",4:"#569cd6",5:"#c586c0",6:"#9cdcfe",7:"#d4d4d4",8:"#808080",9:"#d16969",10:"#b5cea8",11:"#d7ba7d",12:"#569cd6",13:"#c586c0",14:"#9cdcfe",15:"#ffffff"},dark:{0:"#666666",1:"#ff6b6b",2:"#c2e085",3:"#ffd700",4:"#7cb7ff",5:"#ff8ae2",6:"#79eeff",7:"#ffffff",8:"#999999",9:"#ff8080",10:"#d4ff80",11:"#ffed80",12:"#80caff",13:"#ff99ff",14:"#80ffff",15:"#ffffff"}},je=({text:j})=>{const t=(r=>{const c=[];let s={text:"",style:{}},l=0;for(;l<r.length;)if(r[l]==="\x1B"&&r[l+1]==="["){s.text&&(c.push({...s}),s={text:"",style:{...s.style}}),l+=2;let u="";for(;l<r.length&&r[l]!=="m";)u+=r[l],l++;l++;const v=u.split(";").map(Number);for(let m=0;m<v.length;m++){const a=v[m];a===0?s.style={}:a===1?s.style.fontWeight="bold":a===3?s.style.fontStyle="italic":a===4?s.style.textDecoration="underline":a>=30&&a<=37?s.style.color=`var(--ansi-${a-30})`:a>=90&&a<=97?s.style.color=`var(--ansi-${a-82})`:a>=40&&a<=47?s.style.backgroundColor=`var(--ansi-bg-${a-40})`:a>=100&&a<=107&&(s.style.backgroundColor=`var(--ansi-bg-${a-92})`)}}else s.text+=r[l],l++;return s.text&&c.push(s),c})(j);return e.jsxs("div",{className:"font-mono leading-5 whitespace-pre-wrap text-gray-100 dark:text-gray-200",children:[e.jsx("style",{children:`
                    :root {
                        /* Light mode ANSI colors */
                        ${Object.entries(Z.light).map(([r,c])=>`
                            .light-theme {
                                --ansi-${r}: ${c};
                                --ansi-bg-${r}: ${c}20;
                            }
                        `).join(`
`)}

                        /* Dark mode ANSI colors */
                        ${Object.entries(Z.dark).map(([r,c])=>`
                            .dark-theme {
                                --ansi-${r}: ${c};
                                --ansi-bg-${r}: ${c}20;
                            }
                        `).join(`
`)}
                    }
                `}),t.map((r,c)=>e.jsx("span",{style:{...r.style,fontFamily:"JetBrains Mono"},children:r.text},c))]})},A=(j,S=2)=>{if(!j||j===0)return"0 Bytes";const t=1024,r=S<0?0:S,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(j)/Math.log(t));return parseFloat((j/Math.pow(t,s)).toFixed(r))+" "+c[s]},Ce=()=>{var q,J,z,D,K,U,G,H;const{id:j}=ne(),S=re(),[t,r]=d.useState(null),[c,s]=d.useState(!0),[l,u]=d.useState(null),[v,m]=d.useState([]),[a,I]=d.useState(""),[x,E]=d.useState(!1),[B,T]=d.useState(!1),[M,$]=d.useState(!1),[Q,P]=d.useState(0),L=3,[O,V]=d.useState({cpuPercent:0,memory:{used:0,limit:0,percent:0},network:{rxBytes:0,txBytes:0}}),g=d.useRef(null),_=d.useRef(null);d.useEffect(()=>((async()=>{var i,k;try{const f=localStorage.getItem("token");if(!f)throw new Error("Authentication token not found");const h=setTimeout(()=>{c&&u("Server request is taking longer than expected...")},3e3),w=await fetch(`/api/servers/${j}?include[node]=true&include[status]=true`,{headers:{Authorization:`Bearer ${f}`}});if(clearTimeout(h),!w.ok){const n=await w.text();throw new Error(`Failed to fetch server: ${w.status} ${n}`)}const p=await w.json();if(!((i=p.node)!=null&&i.fqdn)||!((k=p.node)!=null&&k.port))throw new Error("Server node information is missing");r(p),W(p)}catch(f){console.error("Error fetching server:",f),u(f instanceof Error?f.message:"An error occurred"),s(!1),$(!0)}})(),()=>{g.current&&g.current.close()}),[j]),d.useEffect(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[v]);const W=o=>{if(!localStorage.getItem("token")){u("Authentication token not found"),s(!1),$(!0);return}g.current&&g.current.close();const k=`ws://${o.node.fqdn}:${o.node.port}?server=${o.internalId}&token=${o.validationToken}`,f=setTimeout(()=>{c&&u("Attempting to connect to Krypton node...")},500);try{console.log(`Attempting to connect to WebSocket: ${k}`);const h=new WebSocket(k);g.current=h;const w=setTimeout(()=>{h.readyState!==WebSocket.OPEN&&(console.log("WebSocket connection timeout after 3 seconds"),clearTimeout(f),h.close(),R())},3e3);h.onopen=()=>{clearTimeout(w),clearTimeout(f),console.log("WebSocket connected successfully"),E(!0),$(!1),u(null),P(0),s(!1)},h.onmessage=p=>{s(!1);const n=JSON.parse(p.data);switch(n.event){case"console_output":typeof n.data.message=="string"&&m(b=>[...b,n.data.message]);break;case"auth_success":n.data.logs&&m(n.data.logs.map(b=>b));break;case"stats":n.data.cpu_percent!==void 0&&V({cpuPercent:n.data.cpu_percent||0,memory:n.data.memory||{used:0,limit:0,percent:0},network:n.data.network?{rxBytes:n.data.network.rx_bytes,txBytes:n.data.network.tx_bytes}:{rxBytes:0,txBytes:0}}),n.data.state&&r(b=>b?{...b,state:n.data.state||b.state}:null);break;case"power_status":n.data.status!==void 0&&m(b=>[...b,n.data.status.toString()]),T(!1);break;case"error":const X=n.data.message||"An unknown error occurred";u(X),m(b=>[...b,`Error: ${X}`]),T(!1);break}},h.onclose=p=>{if(clearTimeout(w),clearTimeout(f),console.log(`WebSocket disconnected with code: ${p.code}, reason: ${p.reason}`),E(!1),!M){const n=Q+1;P(n),n>=L?(console.log(`Max connection attempts (${L}) reached. Marking node as down.`),R()):(console.log(`Connection attempt ${n} of ${L} failed. Retrying...`),setTimeout(()=>{(!g.current||g.current.readyState===WebSocket.CLOSED)&&W(o)},2e3))}},h.onerror=p=>{clearTimeout(w),clearTimeout(f),console.error("WebSocket error:",p)}}catch(h){clearTimeout(f),console.error("Failed to create WebSocket:",h),R()}},R=()=>{$(!0),E(!1),s(!1),u("Failed to connect to Krypton. The node may be down or experiencing issues."),console.log("Connection to Krypton failed. Node marked as down.")},ee=o=>{if(o.preventDefault(),!a.trim()||!g.current){m(i=>[...i,"\x1B[33m[System] Cannot send command - WebSocket not connected or empty command\x1B[0m"]);return}if(!y){m(i=>[...i,"\x1B[33m[System] Cannot send command - server is not running\x1B[0m"]);return}try{g.current.send(JSON.stringify({event:"send_command",data:a})),m(i=>[...i,"\x1B[32m$ \x1B[0m"+a+"\x1B[0m"]),I("")}catch(i){m(k=>[...k,`\x1B[31m[System] Failed to send command: ${i}\x1B[0m`])}},F=async o=>{if(!(!t||B||!g.current)){T(!0);try{g.current.send(JSON.stringify({event:"power_action",data:{action:o}}))}catch(i){u(i instanceof Error?i.message:`Failed to ${o} server`),T(!1)}}},te=o=>{switch(o==null?void 0:o.toLowerCase()){case"running":return"text-green-500";case"stopped":return"text-red-500";case"installing":return"text-yellow-500";default:return"text-gray-500"}},se=()=>{$(!1),P(0),s(!0),t?W(t):window.location.reload()};if(c)return e.jsx(ae,{});if(M)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"border border-gray-200 rounded-lg p-8",children:[e.jsx("div",{className:"w-16 h-16 flex items-center justify-center bg-gray-100 rounded-lg mb-6",children:e.jsx(Ne,{className:"w-8 h-8 text-gray-500"})}),e.jsx("h2",{className:"text-xl font-semibold tracking-tight text-gray-900 mb-2",children:"Node connection failed"}),e.jsx("p",{className:"text-gray-600 text-xs mb-6",children:"We're unable to connect to your server. Please contact an administrator."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:se,className:"w-48 text-xs mr-2 py-2 px-4 bg-indigo-700 hover:bg-indigo-800 text-white rounded-md transition duration-200",children:"Retry Connection"}),e.jsx("button",{onClick:()=>S("/servers"),className:"w-48 text-xs py-2 px-4 border border-gray-200 hover:bg-gray-100 text-gray-800 rounded-md transition duration-200",children:"Back to Servers"})]})]})});const y=((q=t==null?void 0:t.state)==null?void 0:q.toLowerCase())==="running";let N=(J=t==null?void 0:t.status)!=null&&J.allocation?JSON.parse(t.status.allocation):null;return e.jsx("div",{className:"min-h-screen px-8 py-8 bg-gray-50",children:e.jsxs("div",{className:"max-w-[1500px] mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>S("/servers"),className:"hover:text-gray-900",children:"Servers"}),e.jsx(oe,{className:"w-4 h-4 mx-1"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t==null?void 0:t.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t==null?void 0:t.name}),e.jsxs("div",{className:"flex items-center space-x-3",children:[l&&!M&&e.jsxs("div",{className:`flex items-center px-3 py-1.5 text-xs text-red-700 bg-red-50 
                              border border-red-100 rounded-md`,children:[e.jsx(Y,{className:"w-3.5 h-3.5 mr-1.5"}),l]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>F("start"),disabled:B||y||!x,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(xe,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>F("restart"),disabled:B||!y||!x,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(ce,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{onClick:()=>F("stop"),disabled:B||!y||!x,className:`flex items-center px-4 py-4 cursor-pointer text-xs font-medium text-gray-700
                           bg-white border border-gray-200 rounded-xl 
                           hover:bg-gray-50 disabled:opacity-50 transition-all duration-200`,children:e.jsx(ye,{className:"w-4 h-4 text-gray-700"})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(de,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{children:t==null?void 0:t.internalId.split("-",1)})]}),e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(ie,{className:"w-4 h-4 mr-1.5"}),e.jsxs("span",{children:[N!=null&&N.alias?N.alias:N==null?void 0:N.bindAddress,":",(N==null?void 0:N.port)||"unknown"]})]}),e.jsxs("div",{className:`flex items-center ${te((t==null?void 0:t.state)||"")}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${((z=t==null?void 0:t.state)==null?void 0:z.toLowerCase())==="running"?"bg-green-500":((D=t==null?void 0:t.state)==null?void 0:D.toLowerCase())==="stopped"?"bg-red-500":((K=t==null?void 0:t.state)==null?void 0:K.toLowerCase())==="installed"?"bg-gray-500":"bg-yellow-500"}`}),e.jsx("span",{children:(((U=t==null?void 0:t.state)==null?void 0:U.charAt(0).toUpperCase())+((G=t==null?void 0:t.state)==null?void 0:G.slice(1))||"").replace("Installed","Connecting...")})]}),!x&&!M&&e.jsxs("div",{className:"flex items-center text-yellow-600",children:[e.jsx(Y,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{children:"Reconnecting..."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6 border-t border-b border-gray-200/50 py-8",children:[e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"CPU Usage"}),e.jsx("div",{className:"flex items-baseline mt-1",children:e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y&&x?`${O.cpuPercent.toFixed(1)}%`:"-"})})]}),e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Memory"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y&&x?A(O.memory.used):"-"}),y&&x&&e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-500",children:["/ ",A((H=t==null?void 0:t.status)==null?void 0:H.memory_limit)]})]})]}),e.jsxs("div",{className:"border-r border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Network I/O"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y&&x?A(O.network.rxBytes):"-"}),y&&x&&e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:"/s in"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Disk Space"}),e.jsxs("div",{className:"flex items-baseline mt-1",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:A(((t==null?void 0:t.diskMiB)||0)*1024*1024)}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:"total"})]})]})]}),e.jsxs("div",{className:`border-2 border-gray-50 rounded-2xl ring-2 ring-gray-50
                      ring-offset-1 ring-offset-gray-300 bg-[#191b25]`,children:[e.jsx("div",{ref:_,style:{fontFamily:"JetBrains Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},className:"h-[400px] p-4 overflow-y-auto text-xs text-gray-300 relative",children:v.length>0?v.map((o,i)=>e.jsx(je,{text:o},i)):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-500 mt-4",children:[e.jsx(pe,{className:`w-12 h-12 mb-2 ring-2 ring-[#191b25] border-4 border-[#191b25] ring-offset-1 
                                 ring-offset-white/5 opacity-80 bg-white/5 rounded-xl p-3`}),e.jsx("p",{className:"text-sm mt-4 text-gray-400/90 font-medium",children:"No console output available"}),e.jsx("p",{className:"text-xs mt-1",children:"Perform an action to see some logs here!"})]})}),e.jsx("div",{className:"bg-[#30313a] p-2 m-2 rounded-b-xl rounded-t-md",children:e.jsxs("form",{onSubmit:ee,className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:a,onChange:o=>I(o.target.value),placeholder:"$ server~",disabled:!x||!y,className:`flex-1 bg-[#30313a] text-gray-100 rounded-md text-sm transition px-3 py-2 
                         focus:outline-none focus:ring-1 focus:ring-transparent placeholder:text-gray-500
                         disabled:opacity-50 disabled:cursor-not-allowed`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs hidden text-gray-500",children:x?"Connected":"Disconnected"}),e.jsxs("button",{type:"submit",disabled:!x||!y,className:`flex items-center px-3 py-2 cursor-pointer border border-white/5 text-xs font-medium 
                           text-indigo-100 bg-indigo-800/30 rounded-md hover:bg-indigo-800/50 disabled:opacity-50 
                           disabled:cursor-not-allowed transition-colors duration-200`,children:[e.jsx(ue,{className:"w-3.5 h-3.5 mr-1.5"}),"Send"]})]})]})})]})]})})};export{Ce as default};
